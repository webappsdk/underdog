var U={un:function(d){if("undefined"==typeof d||null==d)return!0},escapeSpecialCharsRegExp:function(d){return d.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},type:function(d){return Array.isArray(d)?"array":"string"==typeof d?"string":null!=d&&"object"==typeof d?"object":"other"},loadjs:function(d,h){if(!U.un(d)){var f=document.createElement("script"),g=document.body;if(h){var k=!1;f.onload=f.onreadystatechange=function(){k||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||
(k=!0,h(),f.onload=f.onreadystatechange=null,g&&f.parentNode&&g.removeChild(f))}}f.setAttribute("type","text/javascript");f.setAttribute("src",d);g.appendChild(f)}}};Promise.prototype["finally"]=function(d){return"function"!==typeof d?this.then():this.then(d,d)};
var CH=function(){var d={},h={};return{init:function(f,g){"session"==f?d=window.sessionStorage:"local"==f&&(d=window.localStorage);d["CH.storageType"]=f;if("session"==f||"local"==f)for(var k in d)try{h[k]=JSON.parse(d[k])}catch(l){}g&&g()},cache:function(f,g){if(null==g)return U.un(h[f])?d[f]:h[f];var k=U.type(g);"object"==k||"array"==k?(h[f]=g,new Promise(function(h,k){d[f]=JSON.stringify(g);h()})):d[f]=g},clear:function(f){null==f?(d==window.sessionStorage||d==window.localStorage?d.clear():d={},
h={}):(delete d[f],delete h[f])}}}(),PH=function(){function d(a){var b=a.split(".");if(1<b.length){a={id:a,"package":b[0]};for(var c="",e=1;e<b.length;e++)c+=b[e],e<b.length-1&&(c+="/");a.pluginPath=c;return a}return null}function h(a,b,c,e){if(null==b||"eager"!=b&&"lazy"!=b)b="lazy";var d=CH.cache("PH.loader");if(d[a]){var q=Object.keys(d[a]);if(0<q.length){var r=function(a,c){for(var b=q.length;b--;){var e=q[b],d=g[e];(d.load&&d.load==a||"undefined"==typeof d.load&&"lazy"==a)&&"undefined"==typeof m[e]&&
f(e,null,!0)}},h=function(a,b,c){null==c&&(c=0);if(q.length>c){var e=q[c],d=g[e];(d.load&&d.load==a||"undefined"==typeof d.load&&"lazy"==a)&&"undefined"==typeof m[e]?f(e,function(){c++;h(a,b,c)}):(c++,h(a,b,c))}else b&&b()},g=d[a];e?r(b,c):h(b,c)}}else c&&c()}function f(a,b,c){var e=d(a);null!=e&&(c?(g(e,function(c){PH.fire("plugin-configuration-load-after",{plugin:{id:a},data:c})}),c=CH.cache("PH.roots")[a]+e["package"]+"/client/"+e.pluginPath+".js",U.loadjs(c,b)):g(e,function(c){PH.fire("plugin-configuration-load-after",
{plugin:{id:a},data:c},function(){var c=CH.cache("PH.roots")[a]+e["package"]+"/client/"+e.pluginPath+".js";U.loadjs(c,b)})}))}function g(a,b){var c=CH.cache("PH.configurations"),e=a.id;if(c[e])b(c[e]);else{var d=CH.cache("PH.roots")[e]+"/"+a["package"]+"/configuration.json";CRUD.loadJSON(d,function(a){c[e]=a;CH.cache("PH.configurations",c);b(a)})}}function k(a,b){var c=b["extends"];if("array"==U.type(c))for(var e=a["extends"],d=c.length;d--;){var f=c[d];-1==e.indexOf(f)&&e.push(f)}for(var r in b)"undefined"==
typeof a[r]&&(a[r]=b[r])}function l(a){if("array"==U.type(a["extends"])){for(var b=a["extends"],c=b.length;c--;){var e=b[c];n[e]?n[e].push(a.id):n[e]=[a.id];e=PH.getPluginById(e);null!=e&&(k(a,e),e.removeEvents())}return!0}return!1}function t(a){var b=!1;if(n[a.id]){for(var c=n[a.id],e=c.length;e--;){var d=PH.getPluginById(c[e]);null!=d&&(k(d,a),b=!0)}b&&a.removeEvents()}return b}function u(a){var b=CH.cache("PH.roots");a._root=b[a.id]?b[a.id]:"./";for(var c in v)"undefined"==typeof a[c]&&(a[c]=v[c])}
function w(a,b,c,e,d){var f={plugin:a,data:b,eventName:c};PH.fire(a.id+"-before",f,function(b){(new Promise(function(h,g){PH.fire(a.id+"-in-process",f);var k=CH.cache("PH.configurations")[a.id];U.un(k)&&(k={});try{a.run(b,k,c,function(b){e&&e({plugin:a,data:b,eventName:c})},function(b){d&&d({plugin:a,data:b,eventName:c})}),h()}catch(l){if(console.error((a.id?"["+a.id+"]":"")+" plugin execution failure : ",l),"function"==typeof a.onFailure)try{var m=a.onFailure("plugin_execution_failure",b,c);U.un(m)?
g("plugin_execution_failure"):g(m)}catch(n){g("plugin_execution_failure")}else g("plugin_execution_failure")}})).then(function(c){PH.fire(a.id+"-after",f)},function(c){a.remove();d&&d(f);PH.fire("plugin-execution-failure",f)})})}function x(a,b,c,e){null!=a&&"function"==typeof a.onMessage&&new Promise(function(d,f){try{a.onMessage(b,c,e)}catch(g){}})}var y=-1,p={},m={},n={},v={getResourcePath:function(){try{var a=this.id.split("."),b="",c=a.length-1;if(0<c)for(;c--;)b="/"+a[c]+b;else b="/"+a[0];return this._root+
b+"/resources/"}catch(e){return""}},removeEvents:function(){var a=this.events,b=null;if("array"==U.type(a)){if(0==arguments.length)b=this.events;else for(var b=[],c=arguments.length;c--;){var e=arguments[c];"string"==typeof e&&a[e]&&b.push(e)}for(c=b.length;c--;)a=b[c],p[a]&&(a=p[a],e=a.indexOf(this.id),-1<e&&a.splice(e,1))}},removeFromLoader:function(){if(this.events&&m[this.id])for(var a=CH.cache("PH.loader"),b=this.events.length;b--;){var c=this.events[b];a[c]&&(c=a[c],c[this.id]&&delete c[this.id])}},
remove:function(){var a={plugin:this},b=this;PH.fire("plugin-remove-before",a,function(){(new Promise(function(c,e){PH.fire("plugin-remove-in-process",a);CH.cache("PH.roots")[b.id]&&delete CH.cache("PH.roots")[b.id];n[b.id]&&delete n[b.id];b.removeFromLoader();b.removeEvents();delete m[b.id];c()}))["finally"](function(){PH.fire("plugin-remove-after",a)})})},call:function(a,b){if("function"==typeof this[a])this[a](b)}};return{init:function(){if(0<arguments.length){var a=function(b,e,d,f){if("string"==
U.type(c[b])){var g=c[b];CRUD.loadJSON(g+"loader.json",function(h){for(var k in h)if("undefined"==typeof e[k]){e[k]=h[k];var l=h[k],m;for(m in l)d[m]=g}else{var l=h[k],n=e[k];for(m in l)d[m]=g,n[m]=l[m]}b++;b<c.length?a(b,e,d,f):(CH.cache("PH.loader",e),CH.cache("PH.roots",d),f(e))})}},b=function(a){for(var b in a)"init-ph-after"!=b&&h(b,"eager",null,!0);PH.fire("init-ph-after")},c=arguments;U.un(CH.cache("PH.configurations"))&&CH.cache("PH.configurations",{});U.un(CH.cache("PH.resources"))&&CH.cache("PH.resources",
{});var e=CH.cache("PH.loader"),d=CH.cache("PH.roots");U.un(e)||U.un(d)?a(0,{},{all:c},b):b(e)}},stop:function(){CH.clear("PH.configurations");CH.clear("PH.resources");CH.clear("PH.loader");CH.clear("PH.roots");p={};m={};n={}},reset:function(){var a=CH.cache("PH.roots");a.all&&(PH.stop(),PH.init.apply(this,a.all))},add:function(a,b){u(a);var c=!1;"undefined"==typeof a.id&&(a.id=++y,c=!0);m[a.id]=a;l(a);var e=!1;c||(e=t(a));c={plugin:a,data:b};if(e)PH.fire("plugin-add-after",c);else if(e=a.events,
U.un(e)||"array"==U.type(e)&&0==e.length)PH.fire("plugin-add-after",c,function(){a.removeFromLoader();w(a,b)});else{for(var d=e.length;d--;){var f=e[d];"string"==typeof f&&"undefined"==typeof p[f]&&(p[f]=[]);p[f].push(a.id)}PH.fire("plugin-add-after",c)}},fire:function(a,b,c,e){h(a,"lazy",function(){if(p[a])for(var d=p[a],f=d.length;f--;){var g=PH.getPluginById(d[f]);w(g,b,a,c,e)}else c&&(b.data&&(b=b.data),c(b))})},getPluginById:function(a){return m[a]?m[a]:null},sendMessage:function(a,b,c,e){new Promise(function(d,
f){if(U.un(c)){var g=null,h;for(h in m)g=m[h],x(g,a,b,e)}else for(h=c.length;h--;)g=PH.getPluginById(c[h]),x(g,a,b,e);d()})},addDecorator:function(a,b){v[a]=b},removeDecorator:function(a){delete v[a]}}}(),CRUD={loadJSON:function(d,h,f){CRUD.load(d,h,!0,f)},load:function(d,h,f,g,k){var l;if("undefined"!==typeof XMLHttpRequest)l=new XMLHttpRequest;else for(var t=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],u=t.length;u--;)try{l=new ActiveXObject(t[u]);
break}catch(w){}l.onreadystatechange=function(){if(!(4>l.readyState)&&200===l.status&&4===l.readyState)if(U.un(f))h(l.responseText);else try{h(JSON.parse(l.responseText))}catch(d){h({})}};U.un(g)&&(g="GET");l.open(g,d,!0);if(U.un(k))l.send();else{d="";for(key in k)d+=encodeURIComponent(key)+"="+encodeURIComponent(k[key])+"&";l.send(d)}}};
