function U(){}U.un=function(a){if("undefined"==typeof a||null==a)return!0};U.escapeSpecialCharsRegExp=function(a){return a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")};U.type=function(a){return Array.isArray(a)?"array":"string"==typeof a?"string":null!=a&&"object"==typeof a?"object":"other"};
U.loadjs=function(a,b){if(!U.un(a)){var c=document.createElement("script"),d=document.body;if(b){var e=!1;c.onload=c.onreadystatechange=function(){e||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(e=!0,b(),c.onload=c.onreadystatechange=null,d&&c.parentNode&&d.removeChild(c))}}c.setAttribute("type","text/javascript");c.setAttribute("src",a);d.appendChild(c)}};Promise.prototype["finally"]=function(a){return"function"!==typeof a?this.then():this.then(a,a)};
function CH(){}CH.storage={};CH.objStorage={};CH.maxSize=1024;CH.init=function(a,b){"session"==a?CH.storage=window.sessionStorage:"local"==a&&(CH.storage=window.localStorage);CH.storage["CH.storageType"]=a;"session"!=a&&"local"!=a||CH.parseObjects();b&&b()};CH.cache=function(a,b){if(null==b)return U.un(CH.objStorage[a])?CH.storage[a]:CH.objStorage[a];var c=U.type(b);"object"==c||"array"==c?(CH.objStorage[a]=b,new Promise(function(c,e){CH.storage[a]=JSON.stringify(b);c()})):CH.storage[a]=b};
CH.clear=function(a){null==a?(CH.storage==window.sessionStorage||CH.storage==window.localStorage?CH.storage.clear():CH.storage={},CH.objStorage={}):(delete CH.storage[a],delete CH.objStorage[a])};CH.parseObjects=function(){for(var a in CH.storage)try{CH.objStorage[a]=JSON.parse(CH.storage[a])}catch(b){}};function PH(){}PH.CACHED_CONFIGURATIONS_ID="PH.configurations";PH.CACHED_RESOURCES_ID="PH.resources";PH.CACHED_DESCRIPTOR_ID="PH.descriptor";PH.CACHED_ROOTS_ID="PH.roots";
PH.EVENT_PLUGIN_JSON_FILE="plugins.json";PH.INIT_PH_AFTER_EVENT="init-ph-after";PH.ERROR_PLUGIN_EXECUTION="error_plugin_execution";PH.events={};PH.plugins={};
PH.init=function(){if(0<arguments.length){var a=arguments;U.un(CH.cache(PH.CACHED_CONFIGURATIONS_ID))&&CH.cache(PH.CACHED_CONFIGURATIONS_ID,{});U.un(CH.cache(PH.CACHED_RESOURCES_ID))&&CH.cache(PH.CACHED_RESOURCES_ID,{});var b=function(a){(new Promise(function(c,b){for(var d in a)d!=PH.INIT_PH_AFTER_EVENT&&PH.loadPlugins(d,"eager");c()}))["finally"](function(){PH.fire(PH.INIT_PH_AFTER_EVENT)})},c=function(b,d,e,m){if("string"==U.type(a[b])){var l=a[b];CRUD.loadJSON(l+PH.EVENT_PLUGIN_JSON_FILE,function(p){for(var h in p)if(d.hasOwnProperty(h)){var q=
p[h],r=d[h];for(n in q)e[n]=l,r[n]=q[n]}else{d[h]=p[h];var q=p[h],n;for(n in q)e[n]=l}b++;b<a.length?c(b,d,e,m):(CH.cache(PH.CACHED_DESCRIPTOR_ID,d),CH.cache(PH.CACHED_ROOTS_ID,e),m(d))})}},d=CH.cache(PH.CACHED_DESCRIPTOR_ID),e=CH.cache(PH.CACHED_ROOTS_ID);U.un(d)||U.un(e)?c(0,{},{},b):b(d)}};
PH.loadPlugins=function(a,b,c){if(null==b||"eager"!=b&&"lazy"!=b)b="lazy";var d=CH.cache(PH.CACHED_DESCRIPTOR_ID);if(d.hasOwnProperty(a)){var e=Object.keys(d[a]);if(0<e.length){var f=d[a],g=function(a,c,b){null==b&&(b=0);if(e.length>b){var d=e[b],h=f[d];(h.hasOwnProperty("load")&&h.load==a||!h.hasOwnProperty("load")&&"lazy"==a)&&!PH.plugins.hasOwnProperty(d)?PH.loadPlugin(d,function(){b++;g(a,c,b)}):(b++,g(a,c,b))}else c&&c()};g(b,c)}}else c&&c()};
PH.loadPlugin=function(a,b){var c=PH.pluginCoordinates(a);null!=c&&PH.loadPluginConfiguration(c,function(){var d=CH.cache(PH.CACHED_ROOTS_ID)[a]+c["package"]+"/client/"+c.pluginPath+".js";U.loadjs(d,b)})};PH.loadPluginConfiguration=function(a,b){var c=CH.cache(PH.CACHED_CONFIGURATIONS_ID),d=a.id;if(c.hasOwnProperty(d))b(c[d]);else{var e=CH.cache(PH.CACHED_ROOTS_ID)[d]+"/"+a["package"]+"/configuration.json";CRUD.loadJSON(e,function(a){c[d]=a;CH.cache(PH.CACHED_CONFIGURATIONS_ID,c);b(a)})}};
PH.add=function(a,b){var c=function(){var b=CH.cache(PH.CACHED_ROOTS_ID);b.hasOwnProperty(a.id)?a.root=b[a.id]:a.root="./";a.getResourcePath=PH._getResourcePath;a.remove=PH._remove;a.call=PH._call},d=a.events;if(U.un(d)||0==d.length)c(),PH.wrappedRun(a,b,null,function(){a.remove()});else if(!U.un(a.id)){for(var e=0;e<d.length;e++){var f=d[e];U.un(PH.events[f])&&(PH.events[f]=[]);PH.events[f].push(a.id)}c();PH.plugins[a.id]=a}};
PH.fire=function(a,b,c){PH.loadPlugins(a,"lazy",function(){if(PH.events.hasOwnProperty(a))for(var d=PH.events[a],e=0;e<d.length;e++){var f=PH.getPluginById(d[e]);null!=f&&PH.wrappedRun(f,b,a,c)}else c&&c(b)})};
PH.wrappedRun=function(a,b,c,d){PH.fire(a.id+"-before",b,function(b){(new Promise(function(d,g){PH.fire(a.id+"-in-process",b);var k=CH.cache(PH.CACHED_CONFIGURATIONS_ID)[a.id];U.un(k)&&(k={});try{var m=a.run(b,k,c);d(m)}catch(p){if("function"==typeof a.onFailure)try{var l=a.onFailure(PH.ERROR_PLUGIN_EXECUTION,b,c);U.un(l)?g(PH.ERROR_PLUGIN_EXECUTION):g(l)}catch(h){g(PH.ERROR_PLUGIN_EXECUTION)}else g(PH.ERROR_PLUGIN_EXECUTION)}})).then(function(a){d&&d(a)},function(b){a.remove();d&&d({success:!1,message:b,
data:{pluginid:a.id}})})["finally"](function(){PH.fire(a.id+"-after",b)})})};PH.getPluginById=function(a){return PH.plugins.hasOwnProperty(a)?PH.plugins[a]:null};PH.sendMessage=function(a,b,c,d){if(U.un(c)){var e=null,f;for(f in PH.plugins)if(e=PH.plugins[f],"function"==typeof e.onMessage)e.onMessage(a,b,d)}else for(f=0;f<c.length;f++)if(e=PH.getPluginById[c[f]],null!=e)e.onMessage(a,b,d)};
PH.pluginCoordinates=function(a){var b=a.split(".");if(1<b.length){a={id:a,"package":b[0]};for(var c="",d=1;d<b.length;d++)c+=b[d],d<b.length-1&&(c+="/");a.pluginPath=c;return a}return null};PH._getResourcePath=function(){try{var a=this.id.split(".");return this.root+"/"+a[0]+"/resources/"}catch(b){return""}};
PH._remove=function(){CH.cache(PH.CACHED_ROOTS_ID).hasOwnProperty(this.id)&&delete CH.cache(PH.CACHED_ROOTS_ID)[this.id];if(this.hasOwnProperty("events")&&PH.plugins.hasOwnProperty(this.id)){for(var a=CH.cache("PH.descriptor"),b=0;b<this.events.length;b++){var c=this.events[b];if(a.hasOwnProperty(c))for(var d=a[c],e=0;e<d.length;e++){var f=d[e];f.hasOwnProperty("package")&&f.hasOwnProperty("plugin")&&f["package"]+"."+f.plugin==this.id&&d.splice(e,1)}PH.events.hasOwnProperty(c)&&(c=PH.events[c],d=
c.indexOf(this.id),-1<d&&c.splice(d,1))}delete PH.plugins[this.id]}};PH._call=function(a,b){if("function"==typeof this[a])this[a](b)};function CRUD(){}CRUD.loadJSON=function(a,b,c){CRUD.load(a,b,!0,c)};
CRUD.load=function(a,b,c,d,e){var f;if("undefined"!==typeof XMLHttpRequest)f=new XMLHttpRequest;else for(var g=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],k=0,m=g.length;k<m;k++)try{f=new ActiveXObject(g[k]);break}catch(l){}f.onreadystatechange=function(){if(!(4>f.readyState)&&200===f.status&&4===f.readyState)if(U.un(c))b(f.responseText);else try{b(JSON.parse(f.responseText))}catch(a){b({})}};U.un(d)&&(d="GET");f.open(d,a,!0);if(U.un(e))f.send();
else{a="";for(key in e)a+=encodeURIComponent(key)+"="+encodeURIComponent(e[key])+"&";f.send(a)}};
