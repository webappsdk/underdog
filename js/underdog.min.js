function U(){}U.un=function(a){if("undefined"==typeof a||null==a)return!0};U.escapeSpecialCharsRegExp=function(a){return a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")};U.type=function(a){return Array.isArray(a)?"array":"string"==typeof a?"string":null!=a&&"object"==typeof a?"object":"other"};
U.loadjs=function(a,b){if(!U.un(a)){var c=document.createElement("script"),d=document.body;if(b){var e=!1;c.onload=c.onreadystatechange=function(){e||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(e=!0,b(),c.onload=c.onreadystatechange=null,d&&c.parentNode&&d.removeChild(c))}}c.setAttribute("type","text/javascript");c.setAttribute("src",a);d.appendChild(c)}};Promise.prototype["finally"]=function(a){return"function"!==typeof a?this.then():this.then(a,a)};
function CH(){}CH.storage={};CH.objStorage={};CH.maxSize=1024;CH.init=function(a,b){"session"==a?CH.storage=window.sessionStorage:"local"==a&&(CH.storage=window.localStorage);CH.storage["CH.storageType"]=a;"session"!=a&&"local"!=a||CH.parseObjects();b&&b()};CH.cache=function(a,b){if(null==b)return U.un(CH.objStorage[a])?CH.storage[a]:CH.objStorage[a];var c=U.type(b);"object"==c||"array"==c?(CH.objStorage[a]=b,new Promise(function(c,e){CH.storage[a]=JSON.stringify(b);c()})):CH.storage[a]=b};
CH.clear=function(a){null==a?(CH.storage==window.sessionStorage||CH.storage==window.localStorage?CH.storage.clear():CH.storage={},CH.objStorage={}):(delete CH.storage[a],delete CH.objStorage[a])};CH.parseObjects=function(){for(var a in CH.storage)try{CH.objStorage[a]=JSON.parse(CH.storage[a])}catch(b){}};function PH(){}PH.CACHED_CONFIGURATIONS_ID="PH.configurations";PH.CACHED_RESOURCES_ID="PH.resources";PH.CACHED_DESCRIPTOR_ID="PH.descriptor";PH.CACHED_ROOTS_ID="PH.roots";
PH.EVENT_PLUGIN_JSON_FILE="plugins.json";PH.INIT_PH_AFTER_EVENT="init-ph-after";PH.PLUGIN_EXECUTION_FAILURE_MESSAGE="plugin_execution_failure";PH.PLUGIN_EXECUTION_FAILURE_EVENT="plugin-execution-failure";PH.PLUGIN_CONFIGURATION_LOAD_EVENT="plugin-configuration-load";PH.PLUGIN_ADD_EVENT="plugin-add";PH.PLUGIN_REMOVE_EVENT="plugin-remove";PH.events={};PH.plugins={};
PH.init=function(){if(0<arguments.length){var a=arguments;U.un(CH.cache(PH.CACHED_CONFIGURATIONS_ID))&&CH.cache(PH.CACHED_CONFIGURATIONS_ID,{});U.un(CH.cache(PH.CACHED_RESOURCES_ID))&&CH.cache(PH.CACHED_RESOURCES_ID,{});var b=function(a){(new Promise(function(c,b){for(var d in a)d!=PH.INIT_PH_AFTER_EVENT&&PH.loadPlugins(d,"eager");c()}))["finally"](function(){PH.fire(PH.INIT_PH_AFTER_EVENT)})},c=function(b,d,e,k){if("string"==U.type(a[b])){var m=a[b];CRUD.loadJSON(m+PH.EVENT_PLUGIN_JSON_FILE,function(p){for(var l in p)if(d.hasOwnProperty(l)){var q=
p[l],r=d[l];for(n in q)e[n]=m,r[n]=q[n]}else{d[l]=p[l];var q=p[l],n;for(n in q)e[n]=m}b++;b<a.length?c(b,d,e,k):(CH.cache(PH.CACHED_DESCRIPTOR_ID,d),CH.cache(PH.CACHED_ROOTS_ID,e),k(d))})}},d=CH.cache(PH.CACHED_DESCRIPTOR_ID),e=CH.cache(PH.CACHED_ROOTS_ID);U.un(d)||U.un(e)?c(0,{},{all:a},b):b(d)}};
PH.reset=function(){var a=CH.cache(PH.CACHED_ROOTS_ID);a.hasOwnProperty("all")&&(a=a.all,CH.clear(PH.CACHED_CONFIGURATIONS_ID),CH.clear(PH.CACHED_RESOURCES_ID),CH.clear(PH.CACHED_DESCRIPTOR_ID),CH.clear(PH.CACHED_ROOTS_ID),PH.init.apply(this,a))};
PH.loadPlugins=function(a,b,c){if(null==b||"eager"!=b&&"lazy"!=b)b="lazy";var d=CH.cache(PH.CACHED_DESCRIPTOR_ID);if(d.hasOwnProperty(a)){var e=Object.keys(d[a]);if(0<e.length){var f=d[a],g=function(a,b,c){null==c&&(c=0);if(e.length>c){var d=e[c],l=f[d];(l.hasOwnProperty("load")&&l.load==a||!l.hasOwnProperty("load")&&"lazy"==a)&&!PH.plugins.hasOwnProperty(d)?PH.loadPlugin(d,function(){c++;g(a,b,c)}):(c++,g(a,b,c))}else b&&b()};g(b,c)}}else c&&c()};
PH.loadPlugin=function(a,b){var c=PH.pluginCoordinates(a);null!=c&&PH.loadPluginConfiguration(c,function(d){PH.fire(PH.PLUGIN_CONFIGURATION_LOAD_EVENT+"-after",{pluginId:a,configuration:d},function(){var d=CH.cache(PH.CACHED_ROOTS_ID)[a]+c["package"]+"/client/"+c.pluginPath+".js";U.loadjs(d,b)})})};
PH.loadPluginConfiguration=function(a,b){var c=CH.cache(PH.CACHED_CONFIGURATIONS_ID),d=a.id;if(c.hasOwnProperty(d))b(c[d]);else{var e=CH.cache(PH.CACHED_ROOTS_ID)[d]+"/"+a["package"]+"/configuration.json";CRUD.loadJSON(e,function(a){c[d]=a;CH.cache(PH.CACHED_CONFIGURATIONS_ID,c);b(a)})}};
PH.add=function(a,b){var c=function(){var c=CH.cache(PH.CACHED_ROOTS_ID);c.hasOwnProperty(a.id)?a.root=c[a.id]:a.root="./";a.getResourcePath=PH._getResourcePath;a.remove=PH._remove;a.call=PH._call},d={plugin:a,parameters:b},e=a.events;if(U.un(e)||0==e.length)c(),PH.fire(PH.PLUGIN_ADD_EVENT+"-after",d,function(){PH.wrappedRun(a,b,null,function(){a.remove()})});else if(!U.un(a.id)){for(var f=0;f<e.length;f++){var g=e[f];U.un(PH.events[g])&&(PH.events[g]=[]);PH.events[g].push(a.id)}c();PH.plugins[a.id]=
a;PH.fire(PH.PLUGIN_ADD_EVENT+"-after",d)}};PH.fire=function(a,b,c){PH.loadPlugins(a,"lazy",function(){if(PH.events.hasOwnProperty(a))for(var d=PH.events[a],e=0;e<d.length;e++){var f=PH.getPluginById(d[e]);null!=f&&PH.wrappedRun(f,b,a,c)}else c&&c(b)})};
PH.wrappedRun=function(a,b,c,d){PH.fire(a.id+"-before",b,function(b){(new Promise(function(d,g){PH.fire(a.id+"-in-process",b);var h=CH.cache(PH.CACHED_CONFIGURATIONS_ID)[a.id];U.un(h)&&(h={});try{var k=a.run(b,h,c);d(k)}catch(p){if("function"==typeof a.onFailure)try{var m=a.onFailure(PH.PLUGIN_EXECUTION_FAILURE_MESSAGE,b,c);U.un(m)?g(PH.PLUGIN_EXECUTION_FAILURE_MESSAGE):g(m)}catch(l){g(PH.PLUGIN_EXECUTION_FAILURE_MESSAGE)}else g(PH.PLUGIN_EXECUTION_FAILURE_MESSAGE)}})).then(function(a){d&&d(a)},function(b){a.remove();
b={success:!1,message:b,data:{pluginId:a.id}};d&&d(b);PH.fire(PH.PLUGIN_EXECUTION_FAILURE_EVENT,b)})["finally"](function(){PH.fire(a.id+"-after",b)})})};PH.getPluginById=function(a){return PH.plugins.hasOwnProperty(a)?PH.plugins[a]:null};PH.sendMessage=function(a,b,c,d){if(U.un(c)){var e=null,f;for(f in PH.plugins)if(e=PH.plugins[f],"function"==typeof e.onMessage)e.onMessage(a,b,d)}else for(f=0;f<c.length;f++)if(e=PH.getPluginById[c[f]],null!=e)e.onMessage(a,b,d)};
PH.pluginCoordinates=function(a){var b=a.split(".");if(1<b.length){a={id:a,"package":b[0]};for(var c="",d=1;d<b.length;d++)c+=b[d],d<b.length-1&&(c+="/");a.pluginPath=c;return a}return null};PH._getResourcePath=function(){try{var a=this.id.split(".");return this.root+"/"+a[0]+"/resources/"}catch(b){return""}};
PH._remove=function(){var a={plugin:this};PH.fire(PH.PLUGIN_REMOVE_EVENT+"-before",a,function(){console.log("here0");(new Promise(function(b,c){PH.fire(PH.PLUGIN_REMOVE_EVENT+"-in-process",a);CH.cache(PH.CACHED_ROOTS_ID).hasOwnProperty(this.id)&&delete CH.cache(PH.CACHED_ROOTS_ID)[this.id];if(this.hasOwnProperty("events")&&PH.plugins.hasOwnProperty(this.id)){for(var d=CH.cache("PH.descriptor"),e=0;e<this.events.length;e++){var f=this.events[e];if(d.hasOwnProperty(f))for(var g=d[f],h=0;h<g.length;h++){var k=
g[h];k.hasOwnProperty("package")&&k.hasOwnProperty("plugin")&&k["package"]+"."+k.plugin==this.id&&g.splice(h,1)}PH.events.hasOwnProperty(f)&&(f=PH.events[f],g=f.indexOf(this.id),-1<g&&f.splice(g,1))}delete PH.plugins[this.id]}b()}))["finally"](function(){PH.fire(PH.PLUGIN_REMOVE_EVENT+"-after",a)})})};PH._call=function(a,b){if("function"==typeof this[a])this[a](b)};function CRUD(){}CRUD.loadJSON=function(a,b,c){CRUD.load(a,b,!0,c)};
CRUD.load=function(a,b,c,d,e){var f;if("undefined"!==typeof XMLHttpRequest)f=new XMLHttpRequest;else for(var g=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],h=0,k=g.length;h<k;h++)try{f=new ActiveXObject(g[h]);break}catch(m){}f.onreadystatechange=function(){if(!(4>f.readyState)&&200===f.status&&4===f.readyState)if(U.un(c))b(f.responseText);else try{b(JSON.parse(f.responseText))}catch(a){b({})}};U.un(d)&&(d="GET");f.open(d,a,!0);if(U.un(e))f.send();
else{a="";for(key in e)a+=encodeURIComponent(key)+"="+encodeURIComponent(e[key])+"&";f.send(a)}};
