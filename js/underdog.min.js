var U={un:function(c){if("undefined"==typeof c||null==c)return!0},escapeSpecialCharsRegExp:function(c){return c.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},type:function(c){return Array.isArray(c)?"array":"string"==typeof c?"string":null!=c&&"object"==typeof c?"object":"other"},loadjs:function(c,g){if(!U.un(c)){var f=document.createElement("script"),h=document.body;if(g){var k=!1;f.onload=f.onreadystatechange=function(){k||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||
(k=!0,g(),f.onload=f.onreadystatechange=null,h&&f.parentNode&&h.removeChild(f))}}f.setAttribute("type","text/javascript");f.setAttribute("src",c);h.appendChild(f)}}};Promise.prototype["finally"]=function(c){return"function"!==typeof c?this.then():this.then(c,c)};
var CH=function(){var c={},g={};return{init:function(f,h){"session"==f?c=window.sessionStorage:"local"==f&&(c=window.localStorage);c["CH.storageType"]=f;if("session"==f||"local"==f)for(var k in c)try{g[k]=JSON.parse(c[k])}catch(l){}h&&h()},cache:function(f,h){if(null==h)return U.un(g[f])?c[f]:g[f];var k=U.type(h);"object"==k||"array"==k?(g[f]=h,new Promise(function(g,k){c[f]=JSON.stringify(h);g()})):c[f]=h},clear:function(f){null==f?(c==window.sessionStorage||c==window.localStorage?c.clear():c={},
g={}):(delete c[f],delete g[f])}}}(),PH=function(){function c(a){var b=a.split(".");if(1<b.length){a={id:a,"package":b[0]};for(var d="",e=1;e<b.length;e++)d+=b[e],e<b.length-1&&(d+="/");a.pluginPath=d;return a}return null}function g(a,b,d,e){if(null==b||"eager"!=b&&"lazy"!=b)b="lazy";var c=CH.cache("PH.descriptor");if(c[a]){var p=Object.keys(c[a]);if(0<p.length){var g=function(a,d){for(var b=0;b<p.length;b++){var e=p[b],c=k[e];(c.load&&c.load==a||"undefined"==typeof c.load&&"lazy"==a)&&"undefined"==
typeof m[e]&&f(e,null,!0)}},h=function(a,d,b){null==b&&(b=0);if(p.length>b){var e=p[b],c=k[e];(c.load&&c.load==a||"undefined"==typeof c.load&&"lazy"==a)&&"undefined"==typeof m[e]?f(e,function(){b++;h(a,d,b)}):(b++,h(a,d,b))}else d&&d()},k=c[a];e?g(b,d):h(b,d)}}else d&&d()}function f(a,b,d){var e=c(a);null!=e&&(d?(h(e,function(b){PH.fire("plugin-configuration-load-after",{pluginId:a,configuration:b})}),d=CH.cache("PH.roots")[a]+e["package"]+"/client/"+e.pluginPath+".js",U.loadjs(d,b)):h(e,function(d){PH.fire("plugin-configuration-load-after",
{pluginId:a,configuration:d},function(){var d=CH.cache("PH.roots")[a]+e["package"]+"/client/"+e.pluginPath+".js";U.loadjs(d,b)})}))}function h(a,b){var d=CH.cache("PH.configurations"),e=a.id;if(d[e])b(d[e]);else{var c=CH.cache("PH.roots")[e]+"/"+a["package"]+"/configuration.json";CRUD.loadJSON(c,function(a){d[e]=a;CH.cache("PH.configurations",d);b(a)})}}function k(a,b){var d=b["extends"];if("array"==U.type(d))for(var e=a["extends"],c=0;c<d.length;c++){var p=d[c];-1==e.indexOf(p)&&e.push(p)}for(var f in b)"undefined"==
typeof a[f]&&(a[f]=b[f])}function l(a){if("array"==U.type(a["extends"])){for(var b=a["extends"],d=0;d<b.length;d++){var e=b[d];q[e]?q[e].push(a.id):q[e]=[a.id];e=PH.getPluginById(e);null!=e&&(k(a,e),e.removeEvents())}return!0}return!1}function u(a){var b=!1;if(q[a.id]){for(var d=q[a.id],e=0;e<d.length;e++){var c=PH.getPluginById(d[e]);null!=c&&(k(c,a),b=!0)}b&&a.removeEvents()}return b}function t(a){var b=CH.cache("PH.roots");a._root=b[a.id]?b[a.id]:"./";for(var d in v)"undefined"==typeof a[d]&&(a[d]=
v[d])}function w(a,b,d,e){PH.fire(a.id+"-before",b,function(b){(new Promise(function(e,c){PH.fire(a.id+"-in-process",b);var f=CH.cache("PH.configurations")[a.id];U.un(f)&&(f={});try{var h=a.run(b,f,d);e(h)}catch(g){if(console.error((a.id?"["+a.id+"]":"")+" plugin execution failure : ",g),"function"==typeof a.onFailure)try{var k=a.onFailure("plugin_execution_failure",b,d);U.un(k)?c("plugin_execution_failure"):c(k)}catch(l){c("plugin_execution_failure")}else c("plugin_execution_failure")}})).then(function(a){e&&
e(a)},function(b){a.remove();b={success:!1,message:b,data:{pluginId:a.id}};e&&e(b);PH.fire("plugin-execution-failure",b)})["finally"](function(){PH.fire(a.id+"-after",b)})})}var n={},m={},q={},v={getResourcePath:function(){try{var a=this.id.split(".");return this._root+"/"+a[0]+"/resources/"}catch(b){return""}},removeEvents:function(){var a=this.events,b=null;if("array"==U.type(a)){if(0==arguments.length)b=this.events;else for(var b=[],d=0;d<arguments.length;d++){var e=arguments[d];"string"==typeof e&&
a[e]&&b.push(e)}for(d=0;d<b.length;d++)a=b[d],n[a]&&(a=n[a],e=a.indexOf(this.id),-1<e&&a.splice(e,1))}},removeFromDescriptor:function(){if(scope.events&&m[scope.id])for(var a=CH.cache("PH.descriptor"),b=0;b<scope.events.length;b++){var d=scope.events[b];a[d]&&(d=a[d],d[scope.id]&&delete d[scope.id])}},remove:function(){var a={plugin:this},b=this;PH.fire("plugin-remove-before",a,function(){(new Promise(function(d,e){PH.fire("plugin-remove-in-process",a);CH.cache("PH.roots")[b.id]&&delete CH.cache("PH.roots")[b.id];
q[b.id]&&delete q[b.id];scop.removeFromDescriptor();b.removeEvents();delete m[b.id];d()}))["finally"](function(){PH.fire("plugin-remove-after",a)})})},call:function(a,b){if("function"==typeof this[a])this[a](b)}};return{init:function(){if(0<arguments.length){var a=function(b,e,c,f){if("string"==U.type(d[b])){var h=d[b];CRUD.loadJSON(h+"plugins.json",function(g){for(var k in g)if("undefined"==typeof e[k]){e[k]=g[k];var l=g[k],r;for(r in l)c[r]=h}else{var l=g[k],m=e[k];for(r in l)c[r]=h,m[r]=l[r]}b++;
b<d.length?a(b,e,c,f):(CH.cache("PH.descriptor",e),CH.cache("PH.roots",c),f(e))})}},b=function(a){for(var b in a)"init-ph-after"!=b&&g(b,"eager",null,!0);PH.fire("init-ph-after")},d=arguments;U.un(CH.cache("PH.configurations"))&&CH.cache("PH.configurations",{});U.un(CH.cache("PH.resources"))&&CH.cache("PH.resources",{});var e=CH.cache("PH.descriptor"),c=CH.cache("PH.roots");U.un(e)||U.un(c)?a(0,{},{all:d},b):b(e)}},stop:function(){CH.clear("PH.configurations");CH.clear("PH.resources");CH.clear("PH.descriptor");
CH.clear("PH.roots");n={};m={};q={}},reset:function(){var a=CH.cache("PH.roots");a.all&&(PH.stop(),PH.init.apply(this,a.all))},add:function(a,b){t(a);a.id&&(m[a.id]=a);l(a);var d=!1;a.id&&(d=u(a));if(d)PH.fire("plugin-add-after",e);else{var e={plugin:a,parameters:b},d=a.events;if(U.un(d)||0==d.length)PH.fire("plugin-add-after",e,function(){w(a,b,null,function(){a.removeFromDescriptor()})});else if(a.id){for(var c=0;c<d.length;c++){var f=d[c];"undefined"==typeof n[f]&&(n[f]=[]);n[f].push(a.id)}PH.fire("plugin-add-after",
e)}}},fire:function(a,b,d){g(a,"lazy",function(){if(n[a])for(var e=n[a],c=0;c<e.length;c++){var f=PH.getPluginById(e[c]);null!=f&&w(f,b,a,d)}else d&&d(b)})},getPluginById:function(a){return m[a]?m[a]:null},sendMessage:function(a,b,d,c){if(U.un(d)){var f=null,g;for(g in m)if(f=m[g],"function"==typeof f.onMessage)f.onMessage(a,b,c)}else for(g=0;g<d.length;g++)if(f=PH.getPluginById(d[g]),null!=f)f.onMessage(a,b,c)},addDecorator:function(a,b){v[a]=b},removeDecorator:function(a){delete v[a]}}}(),CRUD=
{loadJSON:function(c,g,f){CRUD.load(c,g,!0,f)},load:function(c,g,f,h,k){var l;if("undefined"!==typeof XMLHttpRequest)l=new XMLHttpRequest;else for(var u=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],t=0,w=u.length;t<w;t++)try{l=new ActiveXObject(u[t]);break}catch(n){}l.onreadystatechange=function(){if(!(4>l.readyState)&&200===l.status&&4===l.readyState)if(U.un(f))g(l.responseText);else try{g(JSON.parse(l.responseText))}catch(c){g({})}};U.un(h)&&
(h="GET");l.open(h,c,!0);if(U.un(k))l.send();else{c="";for(key in k)c+=encodeURIComponent(key)+"="+encodeURIComponent(k[key])+"&";l.send(c)}}};
