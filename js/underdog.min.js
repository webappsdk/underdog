var U={un:function(d){if("undefined"==typeof d||null==d)return!0},escapeSpecialCharsRegExp:function(d){return d.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},type:function(d){return Array.isArray(d)?"array":"string"==typeof d?"string":null!=d&&"object"==typeof d?"object":"other"},loadjs:function(d,g){if(!U.un(d)){var f=document.createElement("script"),h=document.body;if(g){var k=!1;f.onload=f.onreadystatechange=function(){k||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||
(k=!0,g(),f.onload=f.onreadystatechange=null,h&&f.parentNode&&h.removeChild(f))}}f.setAttribute("type","text/javascript");f.setAttribute("src",d);h.appendChild(f)}}};Promise.prototype["finally"]=function(d){return"function"!==typeof d?this.then():this.then(d,d)};
var CH=function(){var d={},g={};return{init:function(f,h){"session"==f?d=window.sessionStorage:"local"==f&&(d=window.localStorage);d["CH.storageType"]=f;if("session"==f||"local"==f)for(var k in d)try{g[k]=JSON.parse(d[k])}catch(l){}h&&h()},cache:function(f,h){if(null==h)return U.un(g[f])?d[f]:g[f];var k=U.type(h);"object"==k||"array"==k?(g[f]=h,new Promise(function(g,k){d[f]=JSON.stringify(h);g()})):d[f]=h},clear:function(f){null==f?(d==window.sessionStorage||d==window.localStorage?d.clear():d={},
g={}):(delete d[f],delete g[f])}}}(),PH=function(){function d(a){var b=a.split(".");if(1<b.length){a={id:a,"package":b[0]};for(var c="",e=1;e<b.length;e++)c+=b[e],e<b.length-1&&(c+="/");a.pluginPath=c;return a}return null}function g(a,b,c,e){if(null==b||"eager"!=b&&"lazy"!=b)b="lazy";var d=CH.cache("PH.loader");if(d[a]){var n=Object.keys(d[a]);if(0<n.length){var y=function(a,c){for(var b=0;b<n.length;b++){var e=n[b],d=h[e];(d.load&&d.load==a||"undefined"==typeof d.load&&"lazy"==a)&&"undefined"==typeof m[e]&&
f(e,null,!0)}},g=function(a,c,b){null==b&&(b=0);if(n.length>b){var e=n[b],d=h[e];(d.load&&d.load==a||"undefined"==typeof d.load&&"lazy"==a)&&"undefined"==typeof m[e]?f(e,function(){b++;g(a,c,b)}):(b++,g(a,c,b))}else c&&c()},h=d[a];e?y(b,c):g(b,c)}}else c&&c()}function f(a,b,c){var e=d(a);null!=e&&(c?(h(e,function(b){PH.fire("plugin-configuration-load-after",{pluginId:a,configuration:b})}),c=CH.cache("PH.roots")[a]+e["package"]+"/client/"+e.pluginPath+".js",U.loadjs(c,b)):h(e,function(c){PH.fire("plugin-configuration-load-after",
{pluginId:a,configuration:c},function(){var c=CH.cache("PH.roots")[a]+e["package"]+"/client/"+e.pluginPath+".js";U.loadjs(c,b)})}))}function h(a,b){var c=CH.cache("PH.configurations"),e=a.id;if(c[e])b(c[e]);else{var d=CH.cache("PH.roots")[e]+"/"+a["package"]+"/configuration.json";CRUD.loadJSON(d,function(a){c[e]=a;CH.cache("PH.configurations",c);b(a)})}}function k(a,b){var c=b["extends"];if("array"==U.type(c))for(var e=a["extends"],d=0;d<c.length;d++){var n=c[d];-1==e.indexOf(n)&&e.push(n)}for(var f in b)"undefined"==
typeof a[f]&&(a[f]=b[f])}function l(a){if("array"==U.type(a["extends"])){for(var b=a["extends"],c=0;c<b.length;c++){var e=b[c];p[e]?p[e].push(a.id):p[e]=[a.id];e=PH.getPluginById(e);null!=e&&(k(a,e),e.removeEvents())}return!0}return!1}function t(a){var b=!1;if(p[a.id]){for(var c=p[a.id],e=0;e<c.length;e++){var d=PH.getPluginById(c[e]);null!=d&&(k(d,a),b=!0)}b&&a.removeEvents()}return b}function r(a){var b=CH.cache("PH.roots");a._root=b[a.id]?b[a.id]:"./";for(var c in u)"undefined"==typeof a[c]&&(a[c]=
u[c])}function v(a,b,c,e){PH.fire(a.id+"-before",b,function(b){(new Promise(function(e,d){PH.fire(a.id+"-in-process",b);var f=CH.cache("PH.configurations")[a.id];U.un(f)&&(f={});try{var g=a.run(b,f,c);e(g)}catch(h){if(console.error((a.id?"["+a.id+"]":"")+" plugin execution failure : ",h),"function"==typeof a.onFailure)try{var k=a.onFailure("plugin_execution_failure",b,c);U.un(k)?d("plugin_execution_failure"):d(k)}catch(l){d("plugin_execution_failure")}else d("plugin_execution_failure")}})).then(function(a){e&&
e(a)},function(b){a.remove();b={success:!1,message:b,data:{pluginId:a.id}};e&&e(b);PH.fire("plugin-execution-failure",b)})["finally"](function(){PH.fire(a.id+"-after",b)})})}function w(a,b,c,e){null!=a&&"function"==typeof a.onMessage&&new Promise(function(d,f){try{a.onMessage(b,c,e)}catch(g){}})}var z=-1,q={},m={},p={},u={getResourcePath:function(){try{var a=this.id.split(".");return this._root+"/"+a[0]+"/resources/"}catch(b){return""}},removeEvents:function(){var a=this.events,b=null;if("array"==
U.type(a)){if(0==arguments.length)b=this.events;else for(var b=[],c=0;c<arguments.length;c++){var e=arguments[c];"string"==typeof e&&a[e]&&b.push(e)}for(c=0;c<b.length;c++)a=b[c],q[a]&&(a=q[a],e=a.indexOf(this.id),-1<e&&a.splice(e,1))}},removeFromLoader:function(){if(scope.events&&m[scope.id])for(var a=CH.cache("PH.loader"),b=0;b<scope.events.length;b++){var c=scope.events[b];a[c]&&(c=a[c],c[scope.id]&&delete c[scope.id])}},remove:function(){var a={plugin:this},b=this;PH.fire("plugin-remove-before",
a,function(){(new Promise(function(c,e){PH.fire("plugin-remove-in-process",a);CH.cache("PH.roots")[b.id]&&delete CH.cache("PH.roots")[b.id];p[b.id]&&delete p[b.id];scop.removeFromLoader();b.removeEvents();delete m[b.id];c()}))["finally"](function(){PH.fire("plugin-remove-after",a)})})},call:function(a,b){if("function"==typeof this[a])this[a](b)}};return{init:function(){if(0<arguments.length){var a=function(b,e,d,f){if("string"==U.type(c[b])){var g=c[b];CRUD.loadJSON(g+"loader.json",function(h){for(var k in h)if("undefined"==
typeof e[k]){e[k]=h[k];var l=h[k],m;for(m in l)d[m]=g}else{var l=h[k],x=e[k];for(m in l)d[m]=g,x[m]=l[m]}b++;b<c.length?a(b,e,d,f):(CH.cache("PH.loader",e),CH.cache("PH.roots",d),f(e))})}},b=function(a){for(var b in a)"init-ph-after"!=b&&g(b,"eager",null,!0);PH.fire("init-ph-after")},c=arguments;U.un(CH.cache("PH.configurations"))&&CH.cache("PH.configurations",{});U.un(CH.cache("PH.resources"))&&CH.cache("PH.resources",{});var e=CH.cache("PH.loader"),d=CH.cache("PH.roots");U.un(e)||U.un(d)?a(0,{},
{all:c},b):b(e)}},stop:function(){CH.clear("PH.configurations");CH.clear("PH.resources");CH.clear("PH.loader");CH.clear("PH.roots");q={};m={};p={}},reset:function(){var a=CH.cache("PH.roots");a.all&&(PH.stop(),PH.init.apply(this,a.all))},add:function(a,b){r(a);var c=!1;"undefined"==typeof a.id&&(a.id=++z,c=!0);m[a.id]=a;l(a);var e=!1;c||(e=t(a));if(e)PH.fire("plugin-add-after",d);else{var d={plugin:a,parameters:b},c=a.events;if(U.un(c)||0==c.length)PH.fire("plugin-add-after",d,function(){v(a,b,null,
function(){a.removeFromLoader()})});else{for(e=0;e<c.length;e++){var f=c[e];"undefined"==typeof q[f]&&(q[f]=[]);q[f].push(a.id)}PH.fire("plugin-add-after",d)}}},fire:function(a,b,c){g(a,"lazy",function(){if(q[a])for(var e=q[a],d=0;d<e.length;d++){var f=PH.getPluginById(e[d]);null!=f&&v(f,b,a,c)}else c&&c(b)})},getPluginById:function(a){return m[a]?m[a]:null},sendMessage:function(a,b,c,e){new Promise(function(d,f){if(U.un(c)){var g=null,h;for(h in m)g=m[h],w(g,a,b,e)}else for(h=0;h<c.length;h++)g=
PH.getPluginById(c[h]),w(g,a,b,e);d()})},addDecorator:function(a,b){u[a]=b},removeDecorator:function(a){delete u[a]}}}(),CRUD={loadJSON:function(d,g,f){CRUD.load(d,g,!0,f)},load:function(d,g,f,h,k){var l;if("undefined"!==typeof XMLHttpRequest)l=new XMLHttpRequest;else for(var t=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],r=0,v=t.length;r<v;r++)try{l=new ActiveXObject(t[r]);break}catch(w){}l.onreadystatechange=function(){if(!(4>l.readyState)&&
200===l.status&&4===l.readyState)if(U.un(f))g(l.responseText);else try{g(JSON.parse(l.responseText))}catch(d){g({})}};U.un(h)&&(h="GET");l.open(h,d,!0);if(U.un(k))l.send();else{d="";for(key in k)d+=encodeURIComponent(key)+"="+encodeURIComponent(k[key])+"&";l.send(d)}}};
